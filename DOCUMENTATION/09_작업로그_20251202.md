# 작업 로그 - 2025년 12월 2일

## 📋 프로젝트 개요
- **프로젝트명**: 건축물 온실가스 계산기 웹 변환
- **원본 파일**: `GHGCalc_V0m_lja.xlsm`
- **목표**: 엑셀 계산기를 웹 애플리케이션으로 100% 동일하게 변환

---

## 🔧 주요 작업 내역

### 1. 엑셀 정밀 분석 (5회 정독)

#### 발견된 불일치 사항 및 수정
| 항목 | 이전 값 | 수정 후 | 비고 |
|------|---------|---------|------|
| CH4 IPCC (천연가스) | 5 | **1** | IPCC 기본값 |
| CO2 22년 (천연가스) | 54261 | **56030** | 국가 고유값 |
| CH4 IPCC (국내 무연탄) | 300 | **1** | IPCC 기본값 |
| 열량 IPCC (국내 무연탄) | 27.58 | **26.7** | MJ/kg |
| CO2 17년 (국내 무연탄) | 101839 | **110678** | kg/TJ |

#### 핵심 발견
- **CH4/N2O IPCC 값**: 주거/상업 구분 없음 (단일값)
- **CH4/N2O 국가 값**: 석탄류만 주거(300)/상업(10) 구분

### 2. 지역난방 데이터 동기화

#### _Supplier 시트에서 추출한 정확한 값
**3기 (2019-2023)**
| 지역 | CO2 | CH4 | N2O |
|------|-----|-----|-----|
| 수도권지사 | 35840 | 0.649 | 0.0658 |
| 평택지사 | 11041 | 0.232 | 0.0204 |
| 청주지사 | 66698 | 2.536 | 0.5058 |
| 세종지사 | 41305 | 0.742 | 0.0742 |
| 대구지사 | 42010 | 0.7547 | 0.0755 |
| 김해지사 | 33977 | 0.6056 | 0.0606 |
| 광주전남지사 | 41830 | 13.93 | 1.8397 |

**4기 (2024-2028)**
| 지역 | CO2 | CH4 | N2O |
|------|-----|-----|-----|
| 수도권지사 | 35991 | 0.6519 | 0.0661 |
| 평택지사 | 18391 | 0.3574 | 0.0334 |
| 청주지사 | 67038 | 2.549 | 0.5084 |
| 세종지사 | 41305 | 0.742 | 0.0742 |
| 대구지사 | 53392 | 6.2051 | 0.9549 |
| 양산지사 | 43042 | 0.7686 | 0.0769 |
| 김해지사 | 35595 | 0.6345 | 0.0635 |
| 광주전남지사 | 41830 | 13.93 | 1.8397 |

### 3. 수정된 파일 목록

#### `ghg_calculator_v2/js/data.js`
- CH4/N2O IPCC 값 구조 변경: `ch4_ipcc_res/com` → `ch4_ipcc` (단일값)
- 지역난방 데이터 엑셀과 100% 동기화
- 지역 목록 수정 (평택, 청주, 세종, 김해, 양산, 광주전남)

#### `ghg_calculator_v2/index.html`
- 지역난방 드롭다운 엑셀과 일치하도록 수정

#### `ghg_calculator_v2/js/app.js`
- CH4 IPCC 계산 로직 수정 (주거/상업 구분 제거)
- 양산지사 예외 처리 (3기에 없는 경우 4기 값 사용)

---

## ✅ 검증 테스트 결과

### 테스트 1: 천연가스(LNG) 1ton
- **설정**: T2 열량(49.4), T1 배출(56100), 산화 T1(1.0)
- **결과**: CO2=2.7713, CH4=4.94e-5, N2O=4.94e-6, 합계=2.7739 tCO2eq
- **상태**: ✅ 통과

### 테스트 2: 등유 1kL
- **설정**: T2 열량(34.2), T1 배출(71867), 산화 T1(1.0)
- **결과**: CO2=2.4579, CH4=0.0001, N2O=2.05e-5, 합계=2.4664 tCO2eq
- **상태**: ✅ 통과

### 테스트 3: 주거/상업 CH4 차이 (국내 무연탄)
- **주거용 T2**: CH4 = 0.0058 (300 kg/TJ 적용)
- **상업용 T2**: CH4 = 0.0003 (10 kg/TJ 적용)
- **차이**: 약 30배 ✅

---

## 📊 엑셀 수식 분석 요약

### Main 시트 핵심 수식
```
F5 (시설규모) = IF(연간배출량<5,"A", IF(<50,"B","C"))
D14 (열량 최소Tier) = IF(시설규모="A","T2", IF("B","T2","T3"))
E14 (배출 최소Tier) = IF(시설규모="A","T1", IF("B","T2","T3"))
F15 (산화Tier) = E15 (배출Tier와 연동)

D20 (열량계수) = VLOOKUP(연료, T1→14열, T2→16열)
E20 (CO2 배출계수) = VLOOKUP(연료, T1→3열, T2→9열)
E21 (CH4 배출계수) = VLOOKUP(연료, T1→4열, T2→10열)
E22 (N2O 배출계수) = VLOOKUP(연료, T1→5열, T2→11열)

G20 (CO2 배출량) = 사용량 × 열량 × 배출계수 × 산화계수 × 1e-6
G21 (CH4 배출량) = 사용량 × 열량 × 배출계수 × 1e-6 (산화계수 미적용!)
G22 (N2O 배출량) = 사용량 × 열량 × 배출계수 × 1e-6 (산화계수 미적용!)

H20 (CO2 tCO2eq) = G20 × 1 (GWP)
H21 (CH4 tCO2eq) = G21 × 21 (GWP)
H22 (N2O tCO2eq) = G22 × 310 (GWP)
```

### 단위 체계
- **전기**: kgGHG/MWh
- **열(스팀)**: kgGHG/TJ
- **지역난방**: kgGHG/TJ
- **연료 열량**: MJ/kg (고체), MJ/L (액체), MJ/Nm³ (기체)

---

## 📝 다음 작업 예정
1. 추가 연료 테스트 (국내 무연탄, 경유, B-C유)
2. Scope 2 전체 테스트 (전기, 열전용, 지역난방)
3. T3 직접입력 기능 테스트
4. Excel 내보내기 기능 검증
5. 최종 사용자 매뉴얼 작성

---

## 🔗 관련 문서
- `01_프로젝트_개요.md`
- `02_Main시트_분석.md`
- `03_데이터테이블.md`
- `04_검증_테스트케이스.md`
- `08_프로토타입_개선계획.md`

---
*작성일: 2025-12-02*
*작성자: AI Assistant (Claude)*

